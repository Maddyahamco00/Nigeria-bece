<!-- views/auth/admin-register.ejs -->
<main class="d-flex align-items-center justify-content-center min-vh-100">
  <div class="card shadow-lg border-0 rounded-4" style="max-width: 500px; width: 100%;">
    <div class="card-body p-4">
      <h2 class="text-center fw-bold mb-4 text-primary">Admin Registration</h2>

      <% if (messages.error) { %>
        <div class="alert alert-danger py-2"><%= messages.error %></div>
      <% } %>
      <% if (messages.success) { %>
        <div class="alert alert-success py-2"><%= messages.success %></div>
      <% } %>

      <form action="/auth/admin/register" method="POST" class="needs-validation" novalidate>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="name" class="form-label">Full Name</label>
            <input type="text" id="name" name="name" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" name="email" class="form-control" required>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" id="password" name="password" class="form-control" required>
            <!-- Password Strength Meter -->
            <div class="password-strength mt-2">
              <div class="strength-meter">
                <div class="strength-fill" id="strengthFill"></div>
              </div>
              <small class="strength-text" id="strengthText">Password strength: Weak</small>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="confirmPassword" class="form-label">Confirm Password</label>
            <input type="password" id="confirmPassword" name="confirmPassword" class="form-control" required>
          </div>
        </div>

        <div class="mb-3">
          <label for="role" class="form-label">Admin Role</label>
          <select id="role" name="role" class="form-control" required onchange="toggleFields()">
            <option value="">Select Role</option>
            <option value="admin">General Admin</option>
            <option value="state_admin">State Admin</option>
            <option value="school_admin">School Admin</option>
            <option value="exam_admin">Exam Admin</option>
          </select>
        </div>

        <div class="mb-3" id="stateField" style="display: none;">
          <label for="stateId" class="form-label">Assigned State</label>
          <select name="stateId" class="form-control">
            <option value="">Select State</option>
            <% states.forEach(state => { %>
              <option value="<%= state.id %>"><%= state.name %></option>
            <% }) %>
          </select>
        </div>

        <div class="mb-3" id="schoolField" style="display: none;">
          <label for="schoolId" class="form-label">Assigned School</label>
          <select name="schoolId" class="form-control">
            <option value="">Select School</option>
            <% schools.forEach(school => { %>
              <option value="<%= school.id %>"><%= school.name %> - <%= school.State?.name %></option>
            <% }) %>
          </select>
        </div>

        <button type="submit" id="adminRegisterBtn" class="btn btn-primary w-100 py-2">Register Admin</button>
      </form>

      <p class="mt-3 text-center">
        <a href="/auth/admin" class="text-decoration-none">Back to Login</a>
      </p>
    </div>
  </div>
</main>

<script>
function toggleFields() {
  const role = document.getElementById('role').value;
  const stateField = document.getElementById('stateField');
  const schoolField = document.getElementById('schoolField');
  
  stateField.style.display = 'none';
  schoolField.style.display = 'none';
  
  if (role === 'state_admin') {
    stateField.style.display = 'block';
  } else if (role === 'school_admin') {
    schoolField.style.display = 'block';
  }
}
</script>