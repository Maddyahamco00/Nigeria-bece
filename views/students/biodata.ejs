<!-- views/students/biodata.ejs -->
<main class="d-flex align-items-center justify-content-center py-5" 
      style="background: linear-gradient(135deg, #f8f9fa, #e3f2fd); min-height: 100vh;">

  <div class="card shadow-lg border-0 rounded-4 p-4 w-100" style="max-width: 720px;">
    <div class="text-center mb-4">
      <img src="/images/logo.svg" alt="BECE Logo" class="mb-3" style="width: 70px;">
      <h2 class="fw-bold text-primary">Step 1: Candidate Biodata</h2>
      <p class="text-muted">Fill in your personal details to begin registration.</p>
    </div>

    <!-- Flash Messages -->
    <% if (messages.error) { %>
      <div class="alert alert-danger d-flex align-items-center">
        <i class="bi bi-exclamation-circle-fill me-2"></i>
        <div><%= messages.error %></div>
      </div>
    <% } %>

    <form action="/students/register/biodata" method="POST" class="row g-3" id="biodataForm">
      <!-- Full Name -->
      <div class="col-md-6">
        <label for="name" class="form-label fw-bold">Full Name</label>
        <input id="name" type="text" name="name" class="form-control form-control-lg" 
               placeholder="Enter full name" required>
      </div>

      <!-- Email -->
      <div class="col-md-6">
        <label for="email" class="form-label fw-bold">Email Address</label>
        <input id="email" type="email" name="email" class="form-control form-control-lg" 
               placeholder="Enter email" required>
      </div>

      <!-- Password -->
      <div class="col-md-6">
        <label for="password" class="form-label fw-bold">Password</label>
        <input id="password" type="password" name="password" class="form-control form-control-lg" 
               placeholder="Enter password (min. 6 characters)" required minlength="6">
      </div>

      <!-- Confirm Password -->
      <div class="col-md-6">
        <label for="confirmPassword" class="form-label fw-bold">Confirm Password</label>
        <input id="confirmPassword" type="password" name="confirmPassword" class="form-control form-control-lg" 
               placeholder="Confirm password" required minlength="6">
      </div>

      <!-- Gender -->
      <div class="col-md-6">
        <label for="gender" class="form-label fw-bold">Gender</label>
        <select id="gender" name="gender" class="form-select form-select-lg" required>
          <option value="">Select Gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>
      </div>

      <!-- Date of Birth -->
      <div class="col-md-6">
        <label for="dob" class="form-label fw-bold">Date of Birth</label>
        <input type="date" id="dob" name="dob" class="form-control form-control-lg" required>
      </div>

      <!-- Guardian Phone -->
      <div class="col-md-6">
        <label for="guardianPhone" class="form-label fw-bold">Guardian Phone</label>
        <input type="text" id="guardianPhone" name="guardianPhone" class="form-control form-control-lg" 
               placeholder="Enter phone number" required>
      </div>

      <!-- State -->
      <div class="col-md-6">
        <label for="state" class="form-label fw-bold">State</label>
        <select id="state" name="stateId" class="form-select form-select-lg" required>
          <option value="">Select State</option>
          <% states.forEach(state => { %>
            <option value="<%= state.id %>"><%= state.name %></option>
          <% }) %>
        </select>
      </div>

      <!-- LGA -->
      <div class="col-md-6">
        <label for="lga" class="form-label fw-bold">LGA</label>
        <select id="lga" name="lgaId" class="form-select form-select-lg" required disabled>
          <option value="">Select LGA</option>
        </select>
      </div>

      <!-- School -->
      <div class="col-md-6">
        <label for="school" class="form-label fw-bold">School</label>
        <select id="school" name="schoolId" class="form-select form-select-lg" required disabled>
          <option value="">Select School</option>
        </select>
      </div>

      <!-- Submit -->
      <div class="col-12 d-grid mt-3">
        <button type="submit" class="btn btn-primary btn-lg fw-bold shadow-sm rounded-pill">
          Next: Select Subjects
        </button>
      </div>
    </form>
  </div>
</main>

<script>
const stateSelect = document.getElementById('state');
const lgaSelect = document.getElementById('lga');
const schoolSelect = document.getElementById('school');

stateSelect.addEventListener('change', async (e) => {
  const stateId = e.target.value;
  lgaSelect.innerHTML = '<option value="">Select LGA</option>';
  lgaSelect.disabled = true;
  schoolSelect.innerHTML = '<option value="">Select School</option>';
  schoolSelect.disabled = true;

  if (!stateId) return;

  try {
    const res = await fetch(`/api/lgas/${stateId}`);
    const lgas = await res.json();

    lgas.forEach(lga => {
      const option = document.createElement('option');
      option.value = lga.id;
      option.textContent = lga.name;
      lgaSelect.appendChild(option);
    });
    
    lgaSelect.disabled = false;
  } catch (err) {
    console.error('Error loading LGAs:', err);
  }
});

lgaSelect.addEventListener('change', async (e) => {
  const lgaId = e.target.value;
  schoolSelect.innerHTML = '<option value="">Select School</option>';

  if (!lgaId) {
    schoolSelect.disabled = true;
    return;
  }

  try {
    const res = await fetch(`/api/schools/${lgaId}`);
    const schools = await res.json();

    schools.forEach(school => {
      const option = document.createElement('option');
      option.value = school.id;
      option.textContent = school.name;
      schoolSelect.appendChild(option);
    });

    schoolSelect.disabled = false;
  } catch (err) {
    console.error('Error loading schools:', err);
  }
});
</script>
