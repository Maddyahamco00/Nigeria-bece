<!-- views/students/profile.ejs -->

<main class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-primary">Student Profile</h2>
        <a href="/students/dashboard" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
      </div>

      <!-- Messages -->
      <% if (messages.error) { %>
        <div class="alert alert-danger alert-dismissible fade show">
          <i class="bi bi-exclamation-triangle me-2"></i><%= messages.error %>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      <% } %>
      
      <% if (messages.success) { %>
        <div class="alert alert-success alert-dismissible fade show">
          <i class="bi bi-check-circle me-2"></i><%= messages.success %>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      <% } %>

      <div class="row g-4">
        <!-- Profile Information -->
        <div class="col-md-6">
          <div class="card border-0 shadow-sm rounded-4 h-100">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0"><i class="bi bi-person-badge me-2"></i>Personal Information</h5>
            </div>
            <div class="card-body">
              <form action="/students/profile" method="POST">
                <div class="mb-3">
                  <label class="form-label fw-semibold">Full Name</label>
                  <input type="text" name="name" class="form-control" value="<%= student.name %>" required>
                </div>

                <div class="mb-3">
                  <label class="form-label fw-semibold">Email</label>
                  <input type="email" name="email" class="form-control" value="<%= student.email %>" required>
                </div>

                <div class="mb-3">
                  <label class="form-label fw-semibold">Guardian Phone</label>
                  <input type="text" name="guardianPhone" class="form-control" value="<%= student.guardianPhone %>" required>
                </div>

                <div class="mb-3">
                  <label class="form-label fw-semibold">Registration Number</label>
                  <input type="text" class="form-control" value="<%= student.regNumber %>" readonly>
                  <small class="text-muted">This cannot be changed</small>
                </div>

                <button type="submit" class="btn btn-primary w-100">
                  <i class="bi bi-check-circle me-2"></i>Update Profile
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Security & School Info -->
        <div class="col-md-6">
          <!-- Change Password -->
          <div class="card border-0 shadow-sm rounded-4 mb-4">
            <div class="card-header bg-warning text-dark">
              <h5 class="mb-0"><i class="bi bi-shield-lock me-2"></i>Change Password</h5>
            </div>
            <div class="card-body">
              <form action="/students/change-password" method="POST">
                <div class="mb-3">
                  <label class="form-label fw-semibold">Current Password</label>
                  <input type="password" name="currentPassword" class="form-control" required>
                </div>

                <div class="mb-3">
                  <label class="form-label fw-semibold">New Password</label>
                  <input type="password" name="newPassword" class="form-control" required>
                </div>

                <div class="mb-3">
                  <label class="form-label fw-semibold">Confirm New Password</label>
                  <input type="password" name="confirmPassword" class="form-control" required>
                </div>

                <button type="submit" class="btn btn-warning w-100">
                  <i class="bi bi-key me-2"></i>Change Password
                </button>
              </form>
            </div>
          </div>

          <!-- School Information -->
          <div class="card border-0 shadow-sm rounded-4">
            <div class="card-header bg-info text-white">
              <h5 class="mb-0"><i class="bi bi-building me-2"></i>School Information</h5>
            </div>
            <div class="card-body">
              <p><strong>School:</strong> <%= student.School?.name || 'N/A' %></p>
              <p><strong>State:</strong> <%= student.State?.name || 'N/A' %></p>
              <p><strong>LGA:</strong> <%= student.LGA?.name || 'N/A' %></p>
              <p><strong>Payment Status:</strong> 
                <span class="badge bg-<%= student.paymentStatus === 'Paid' ? 'success' : 'warning' %>">
                  <%= student.paymentStatus %>
                </span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
