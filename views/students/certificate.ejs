<!-- views/students/certificate.ejs -->
<div class="student-dashboard">
  <div class="dashboard-hero">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="hero-title">
            <i class="fas fa-certificate me-3"></i>
            BECE Certificate
          </h1>
          <p class="hero-subtitle">Download your official Basic Education Certificate Examination certificate</p>
        </div>
        <div class="col-md-4 text-end">
          <div class="student-avatar">
            <i class="fas fa-award fa-5x"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="container mt-4">
    <div class="row">
      <div class="col-md-3">
        <div class="student-sidebar">
          <h5 class="sidebar-title">Navigation</h5>
          <ul class="nav flex-column">
            <li class="nav-item"><a href="/students/dashboard" class="nav-link"><i class="fas fa-tachometer-alt me-2"></i> Overview</a></li>
            <li class="nav-item"><a href="/students/profile" class="nav-link"><i class="fas fa-user me-2"></i> Profile</a></li>
            <li class="nav-item"><a href="/students/results" class="nav-link"><i class="fas fa-chart-bar me-2"></i> Results</a></li>
            <li class="nav-item"><a href="/students/certificate" class="nav-link active"><i class="fas fa-certificate me-2"></i> Certificate</a></li>
            <li class="nav-item"><a href="/payment" class="nav-link"><i class="fas fa-credit-card me-2"></i> Payments</a></li>
            <li class="nav-item"><a href="/auth/logout" class="nav-link text-danger"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
          </ul>
        </div>
      </div>
      <div class="col-md-9">
        <div class="certificate-card">
          <div class="card-icon">
            <i class="fas fa-certificate"></i>
          </div>
          <div class="card-content">
            <h5>Official BECE Certificate</h5>
            
            <% if (results && results.length > 0) { %>
              <div class="certificate-preview">
                <div class="certificate-header">
                  <h6>FEDERAL REPUBLIC OF NIGERIA</h6>
                  <h6>BASIC EDUCATION CERTIFICATE EXAMINATION</h6>
                  <h6>CERTIFICATE OF COMPLETION</h6>
                </div>
                
                <div class="certificate-body">
                  <p><strong>This is to certify that</strong></p>
                  <h4 class="student-name"><%= student.name.toUpperCase() %></h4>
                  <p>with Registration Number: <strong><%= student.studentCode || student.regNumber %></strong></p>
                  <p>has successfully completed the Basic Education Certificate Examination</p>
                  <p>conducted in <strong><%= new Date().getFullYear() %></strong></p>
                  
                  <div class="results-summary">
                    <h6>SUBJECTS PASSED:</h6>
                    <div class="subjects-grid">
                      <% results.forEach(result => { %>
                        <% if (result.score >= 35) { %>
                          <div class="subject-item">
                            <span class="subject-name"><%= result.subject %></span>
                            <span class="subject-grade">
                              <% if (result.score >= 70) { %>
                                Grade A
                              <% } else if (result.score >= 60) { %>
                                Grade B
                              <% } else if (result.score >= 50) { %>
                                Grade C
                              <% } else if (result.score >= 40) { %>
                                Grade D
                              <% } else { %>
                                Grade E
                              <% } %>
                            </span>
                          </div>
                        <% } %>
                      <% }) %>
                    </div>
                  </div>
                </div>
                
                <div class="certificate-footer">
                  <p><strong>Date of Issue:</strong> <%= new Date().toLocaleDateString() %></p>
                  <p><strong>Certificate Number:</strong> BECE/<%= new Date().getFullYear() %>/<%= student.studentCode || student.regNumber %></p>
                </div>
              </div>
              
              <div class="certificate-actions">
                <button class="action-btn primary" onclick="downloadCertificate()">
                  <i class="fas fa-download me-2"></i>
                  Download PDF Certificate
                </button>
                <button class="action-btn success" onclick="printCertificate()">
                  <i class="fas fa-print me-2"></i>
                  Print Certificate
                </button>
                <button class="action-btn info" onclick="verifyCertificate()">
                  <i class="fas fa-shield-alt me-2"></i>
                  Verify Certificate
                </button>
              </div>
              
            <% } else { %>
              <div class="no-certificate">
                <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                <h6>Certificate Not Available</h6>
                <p>Your BECE certificate is not yet available. This could be because:</p>
                <ul class="text-start">
                  <li>Your results have not been published</li>
                  <li>You did not meet the minimum requirements</li>
                  <li>Your payment is still pending</li>
                </ul>
                <a href="/students/results" class="action-btn primary">
                  <i class="fas fa-chart-bar me-2"></i>
                  Check Results
                </a>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.certificate-card {
  background: var(--white);
  border-radius: var(--border-radius);
  padding: 30px;
  box-shadow: var(--shadow);
  position: relative;
  overflow: hidden;
}

.certificate-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
}

.certificate-preview {
  border: 3px solid var(--primary-color);
  border-radius: var(--border-radius);
  padding: 30px;
  margin: 20px 0;
  background: linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);
  text-align: center;
}

.certificate-header h6 {
  margin: 5px 0;
  font-weight: 700;
  color: var(--dark-color);
}

.certificate-body {
  margin: 30px 0;
}

.student-name {
  color: var(--primary-color);
  font-size: 1.8rem;
  font-weight: 700;
  margin: 20px 0;
  text-decoration: underline;
}

.results-summary {
  margin: 25px 0;
  text-align: left;
}

.subjects-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 10px;
  margin-top: 15px;
}

.subject-item {
  display: flex;
  justify-content: space-between;
  padding: 8px 12px;
  background: var(--white);
  border-radius: 8px;
  border-left: 4px solid var(--success-color);
}

.subject-name {
  font-weight: 600;
}

.subject-grade {
  font-weight: 700;
  color: var(--success-color);
}

.certificate-footer {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 2px solid var(--primary-color);
}

.certificate-actions {
  text-align: center;
  margin-top: 30px;
}

.certificate-actions .action-btn {
  margin: 0 10px 10px 0;
}

.no-certificate {
  text-align: center;
  padding: 40px 20px;
  color: #666;
}

.no-certificate i {
  color: var(--warning-color);
}

.no-certificate ul {
  max-width: 400px;
  margin: 20px auto;
}

@media (max-width: 768px) {
  .certificate-preview {
    padding: 20px;
  }
  
  .student-name {
    font-size: 1.4rem;
  }
  
  .subjects-grid {
    grid-template-columns: 1fr;
  }
  
  .certificate-actions .action-btn {
    display: block;
    width: 100%;
    margin: 10px 0;
  }
}
</style>

<script>
function downloadCertificate() {
  // Create download link for PDF certificate
  const studentCode = '<%= student.studentCode || student.regNumber %>';
  const year = '<%= new Date().getFullYear() %>';
  
  // Show loading state
  const btn = event.target.closest('.action-btn');
  const originalText = btn.innerHTML;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating PDF...';
  btn.disabled = true;
  
  // Simulate PDF generation (replace with actual PDF generation endpoint)
  setTimeout(() => {
    // Reset button
    btn.innerHTML = originalText;
    btn.disabled = false;
    
    // Trigger download
    const link = document.createElement('a');
    link.href = `/students/certificate/download?format=pdf&studentCode=${studentCode}&year=${year}`;
    link.download = `BECE_Certificate_${studentCode}_${year}.pdf`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Show success message
    alert('Certificate downloaded successfully!');
  }, 2000);
}

function printCertificate() {
  // Open print-friendly version
  const studentCode = '<%= student.studentCode || student.regNumber %>';
  const year = '<%= new Date().getFullYear() %>';
  
  window.open(`/students/certificate/print?studentCode=${studentCode}&year=${year}`, '_blank', 'width=800,height=600');
}

function verifyCertificate() {
  const studentCode = '<%= student.studentCode || student.regNumber %>';
  const year = '<%= new Date().getFullYear() %>';
  const certificateNumber = `BECE/${year}/${studentCode}`;
  
  // Show verification modal or redirect to verification page
  alert(`Certificate Verification\n\nCertificate Number: ${certificateNumber}\nStatus: Valid\nIssued: ${new Date().toLocaleDateString()}\n\nThis certificate can be verified at: https://bece.gov.ng/verify`);
}
</script>